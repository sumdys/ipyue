app.controller("goodsDetailCtrl",["$scope","$state","$rootScope","goodsModel","commentModel","$location","$sce","dateService","commonModel","accountModel",function(t,a,e,o,n,i,d,s,l,c){var r=t;$("html,body").animate({scrollTop:"0px"},100);var u=function(){r.data={},r.data.params={},r.data.params.goodsId=i.search().goodsId,r.data.showImg=!1;var t=s.getCurrentDateWithFormat("yyyy-MM-dd");s.setMonthListLength(3),r.data.monthList=s.getMonthList(t),r.data.selectMonthIndex=0,r.data.selectMonth=r.data.monthList[r.data.selectMonthIndex],r.data.currentTab="detail",o.detail(r.data.params,function(t){r.data.slides=[],t.g_recomend_thumb?angular.forEach(t.g_recomend_thumb,function(t,a){var o={link:e.urlLabel+"/goods-detail?goodsId="+r.data.params.goodsId,path:t,alt:"图片"+(a+1)};r.data.slides.push(o)}):r.data.slides=[{link:e.urlLabel+"/goods-detail",path:t.g_thumb,alt:"图片1"}],r.data.goods=t,g(r.data.selectMonth)}),r.$on("ngRepeatFinished",function(t){TouchSlide({slideCell:"#slideBox",mainCell:".bd ul",effect:"leftLoop",startFun:function(t,a){r.$apply(function(){r.pageIndex=t+1})}})}),r.page=function(t){r.pageNum=t+1};var a={goods_id:r.data.params.goodsId,page_size:1};n.list(a,function(t,a,e){(a>0||1==a)&&(r.data.comment=t.data_list[0],r.data.isMoreComment=!1,a>1&&(r.data.isMoreComment=!0))})},g=function(t){var a=(s.getCurrentDateWithFormat("yyyy-MM-dd"),s.getMonthDateList(t.date));r.data.calendar=s.groupDateListByWeek(o.handleInventoryListForCalendar(r.data.goods.inventory_all,a,r.data.selectMonth,"show"))};u(),r.tab=function(t){r.data.currentTab=t},r.openService=function(){e.servicePopup=!0};var h=i.absUrl();r.openMap=function(t){t.x&&t.x&&c.isWeixin()?l.getWXInfo({api:"openLocation",url:h},function(a){r.data.wxConfig=a,wx.config(a),wx.checkJsApi({jsApiList:["openLocation"],success:function(t){console.log(JSON.stringify(t))}}),wx.ready(function(){wx.openLocation({latitude:parseFloat(t.x),longitude:parseFloat(t.y),name:t.title,address:t.address,scale:15,infoUrl:""})})},function(){}):window.location.href=t.link},r.preMonth=function(){r.data.selectMonthIndex>0&&(r.data.selectMonthIndex--,r.data.selectMonth=r.data.monthList[r.data.selectMonthIndex],g(r.data.selectMonth))},r.nextMonth=function(){r.data.selectMonthIndex<r.data.monthList.length-1&&(r.data.selectMonthIndex++,r.data.selectMonth=r.data.monthList[r.data.selectMonthIndex],g(r.data.selectMonth))},r.moreField=!0,r.getMoreFields=function(){r.moreField=!r.moreField},r.moreFacilities=!0,r.getMoreFacilities=function(){r.moreFacilities=!r.moreFacilities},r.moreTip=!0,r.getMoreTip=function(){r.moreTip=!r.moreTip},r.order=function(){var t={goods:r.data.goods};localStorage.setItem("currentOrder",JSON.stringify(t)),window.location.href=e.urlLabel+"/order-select-date?goodsId="+r.data.params.goodsId},r.showImg=function(t,a){r.data.showImg=!0,r.data.imgSlides=[],angular.forEach(t,function(t,a){var e={};e.path=t,e.alt="图片"+(a+1),r.data.imgSlides.push(e)}),r.data.imgindex=a},r.hideImg=function(){r.data.showImg=!1},c.isWeixin()&&l.getWXInfo({api:"onMenuShareAppMessage,onMenuShareTimeline",url:h},function(t){r.wxConfig=t,wx.config(t),wx.ready(function(){wx.onMenuShareAppMessage({title:r.data.goods.g_title+"- 趣聚会别墅",desc:r.data.goods.description,link:h,imgUrl:r.data.slides[0].path,type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:r.data.goods.g_title+"- 趣聚会别墅",link:h,imgUrl:r.data.slides[0].path,success:function(){},cancel:function(){}})})},function(){})}]);